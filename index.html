<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Coarsely measures memory usage of R code run in parallel by regularly taking snapshots of calls to the system command ps.">
<title>Measure Memory Usage for Parallel R Code • syrup</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Measure Memory Usage for Parallel R Code">
<meta property="og:description" content="Coarsely measures memory usage of R code run in parallel by regularly taking snapshots of calls to the system command ps.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">syrup</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/simonpcouch/syrup/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="syrup">syrup<a class="anchor" aria-label="anchor" href="#syrup"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of syrup is to coarsely measure memory usage of R code run in parallel by regularly taking snapshots of calls to the system command <code>ps</code>. The package name is an homage to syrupy (<strong>SY</strong>stem <strong>R</strong>esource <strong>U</strong>sage <strong>P</strong>rofile …um, <strong>Y</strong>eah), a Python tool at <a href="https://github.com/jeetsukumaran/Syrupy" class="external-link">jeetsukumaran/Syrupy</a>. <strong>This package is highly experimental and results ought to be interpreted with caution.</strong></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of syrup like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"simonpcouch/syrup"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/simonpcouch/syrup" class="external-link">syrup</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: bench</span></span></code></pre></div>
<p>The main function in the syrup package is the function by the same name. The main argument to <code><a href="reference/syrup.html">syrup()</a></code> is an expression, and the function outputs a tibble. Supplying a rather boring expression:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/syrup.html">syrup</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 48 × 8</span></span>
<span><span class="co">#&gt;       id time                  pid  ppid name           pct_cpu       rss    vms</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;bch:byt&gt; &lt;bch:&gt;</span></span>
<span><span class="co">#&gt;  1     1 2024-07-03 09:21:29 60958 60522 R                   NA     118MB  392GB</span></span>
<span><span class="co">#&gt;  2     1 2024-07-03 09:21:29 60522 60300 rsession-arm64      NA     840MB  394GB</span></span>
<span><span class="co">#&gt;  3     1 2024-07-03 09:21:29 58919     1 R                   NA     607MB  393GB</span></span>
<span><span class="co">#&gt;  4     1 2024-07-03 09:21:29 97009     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  5     1 2024-07-03 09:21:29 97008     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  6     1 2024-07-03 09:21:29 97007     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  7     1 2024-07-03 09:21:29 97006     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  8     1 2024-07-03 09:21:29 97005     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  9     1 2024-07-03 09:21:29 91012     1 R                   NA     160KB  393GB</span></span>
<span><span class="co">#&gt; 10     1 2024-07-03 09:21:29 90999     1 R                   NA     160KB  393GB</span></span>
<span><span class="co">#&gt; # ℹ 38 more rows</span></span></code></pre></div>
<p>In this tibble, <code>id</code> defines a specific time point at which process usage was snapshotted, and the remaining columns show output derived from <a href="https://ps.r-lib.org/reference/ps.html" class="external-link">ps::ps()</a>. Notably, <code>pid</code> is the process ID, <code>ppid</code> is the process ID of the parent process, <code>pct_cpu</code> is the percent CPU usage, and <code>rss</code> is the resident set size (a measure of memory usage).</p>
<p>The function works by:</p>
<ul>
<li>Setting up another R process <code>sesh</code> that queries memory information at a regular interval,</li>
<li>Evaluating the supplied expression,</li>
<li>Reading the memory information back into the main process from <code>sesh</code>,</li>
<li>Closing <code>sesh</code>, and then</li>
<li>Returning the memory information.</li>
</ul>
</div>
<div class="section level2">
<h2 id="application-model-tuning">Application: model tuning<a class="anchor" aria-label="anchor" href="#application-model-tuning"></a>
</h2>
<p>For a more interesting demo, we’ll tune a regularized linear model using cross-validation with tidymodels. First, loading needed packages:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span></code></pre></div>
<p>Using future to define our parallelism strategy, we’ll set <code>plan(multicore, workers = 5)</code>, indicating that we’d like to use forking with 5 workers. By default, future disables forking from RStudio; I know that, in the context of building this README, this usage of forking is safe, so I’ll temporarily override that default with <code>parallelly.fork.enable</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rlang.r-lib.org/reference/local_options.html" class="external-link">local_options</a></span><span class="op">(</span>parallelly.fork.enable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multicore</span>, workers <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Now, simulating some data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim_regression</span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">#&gt; # A tibble: 1,000,000 × 21</span></span>
<span><span class="co">#&gt;    outcome predictor_01 predictor_02 predictor_03 predictor_04 predictor_05</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1    3.63       -1.88        0.872       -0.799       -0.0379       2.68  </span></span>
<span><span class="co">#&gt;  2   41.6         0.551      -2.47         2.37         3.90         5.18  </span></span>
<span><span class="co">#&gt;  3   -6.99       -2.51       -3.15         2.61         2.13         3.08  </span></span>
<span><span class="co">#&gt;  4   33.2         4.79        1.86        -2.37         4.27        -3.59  </span></span>
<span><span class="co">#&gt;  5   34.3         0.989      -0.315        3.08         2.56        -5.91  </span></span>
<span><span class="co">#&gt;  6   26.7        -2.46       -0.459        1.75        -5.24         5.04  </span></span>
<span><span class="co">#&gt;  7   21.4         1.46       -0.674       -0.894       -3.91        -3.38  </span></span>
<span><span class="co">#&gt;  8   21.7         2.21        1.28        -1.05        -0.561        2.99  </span></span>
<span><span class="co">#&gt;  9   -8.84        1.73        0.0725       0.0976       5.40         4.30  </span></span>
<span><span class="co">#&gt; 10   24.5        -0.916      -0.223       -0.561       -4.12         0.0508</span></span>
<span><span class="co">#&gt; # ℹ 999,990 more rows</span></span>
<span><span class="co">#&gt; # ℹ 15 more variables: predictor_06 &lt;dbl&gt;, predictor_07 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   predictor_08 &lt;dbl&gt;, predictor_09 &lt;dbl&gt;, predictor_10 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   predictor_11 &lt;dbl&gt;, predictor_12 &lt;dbl&gt;, predictor_13 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   predictor_14 &lt;dbl&gt;, predictor_15 &lt;dbl&gt;, predictor_16 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   predictor_17 &lt;dbl&gt;, predictor_18 &lt;dbl&gt;, predictor_19 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   predictor_20 &lt;dbl&gt;</span></span></code></pre></div>
<p>The call to <code>tune_grid()</code> does some setup sequentially before sending data off to the five child processes to actually carry out the model fitting. After models are fitted, data is sent back to the parent process to be combined. To better understand memory usage throughout that process, we wrap the call in <code><a href="reference/syrup.html">syrup()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_mem</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/syrup.html">syrup</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>      <span class="fu">linear_reg</span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"glmnet"</span>, penalty <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>      <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_mem</span></span>
<span><span class="co">#&gt; # A tibble: 158 × 8</span></span>
<span><span class="co">#&gt;       id time                  pid  ppid name           pct_cpu       rss    vms</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;bch:byt&gt; &lt;bch:&gt;</span></span>
<span><span class="co">#&gt;  1     1 2024-07-03 09:21:33 60958 60522 R                   NA    1.12GB  393GB</span></span>
<span><span class="co">#&gt;  2     1 2024-07-03 09:21:33 60522 60300 rsession-arm64      NA  840.28MB  394GB</span></span>
<span><span class="co">#&gt;  3     1 2024-07-03 09:21:33 58919     1 R                   NA  624.81MB  393GB</span></span>
<span><span class="co">#&gt;  4     1 2024-07-03 09:21:33 97009     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  5     1 2024-07-03 09:21:33 97008     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  6     1 2024-07-03 09:21:33 97007     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  7     1 2024-07-03 09:21:33 97006     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  8     1 2024-07-03 09:21:33 97005     1 rsession-arm64      NA     240KB  394GB</span></span>
<span><span class="co">#&gt;  9     1 2024-07-03 09:21:33 91012     1 R                   NA     160KB  393GB</span></span>
<span><span class="co">#&gt; 10     1 2024-07-03 09:21:33 90999     1 R                   NA     160KB  393GB</span></span>
<span><span class="co">#&gt; # ℹ 148 more rows</span></span></code></pre></div>
<p>These results are a bit more interesting than the sequential results from <code>Sys.sleep(1)</code>. Look closely at the <code>ppid</code>s for each <code>id</code>; after a snapshot or two, you’ll see five identical <code>ppid</code>s for each <code>id</code>, and those <code>ppid</code>s match up with the remaining <code>pid</code> in the one remaining R process. This shows us that we’ve indeed distributed computations using forking in that that one remaining R process, the “parent,” has spawned off five child processes from itself.</p>
<p>We can plot the result to get a better sense of how memory usage of these processes changes over time.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worker_ppid</span> <span class="op">&lt;-</span> <span class="fu">ps</span><span class="fu">::</span><span class="fu"><a href="https://ps.r-lib.org/reference/ps_pid.html" class="external-link">ps_pid</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_mem</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ppid</span> <span class="op">==</span> <span class="va">worker_ppid</span> <span class="op">|</span> <span class="va">pid</span> <span class="op">==</span> <span class="va">worker_ppid</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">id</span>, y <span class="op">=</span> <span class="va">rss</span>, group <span class="op">=</span> <span class="va">pid</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">res_mem</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot-mem-1.png" width="100%"></p>
<p>At first, only the parent process has non-<code>NA</code> <code>rss</code>, as tidymodels hasn’t sent data off to any workers yet. Then, each of the 5 workers receives data from tidymodels and begins fitting models. Eventually, each of those workers returns their results to the parent process, and their <code>rss</code> is once again <code>NA</code>. The parent process wraps up its computations before completing evaluation of the expression, at which point <code><a href="reference/syrup.html">syrup()</a></code> returns. (Keep in mind: memory is weird. In the above plot, the total memory allotted to the parent session and its five workers at each ID is not simply the sum of those <code>rss</code> values, as memory is shared among them.) We see a another side of the story come together for CPU usage:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_mem</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ppid</span> <span class="op">==</span> <span class="va">worker_ppid</span> <span class="op">|</span> <span class="va">pid</span> <span class="op">==</span> <span class="va">worker_ppid</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">id</span>, y <span class="op">=</span> <span class="va">pct_cpu</span>, group <span class="op">=</span> <span class="va">pid</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">res_mem</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot-cpu-1.png" width="100%"></p>
<p>The percent CPU usage will always be <code>NA</code> the first time a process ID is seen, as the usage calculation is based on change since the previous recorded measure. As early as we measure, we see the workers at 100% usage, while the parent process is largely idle once it has sent data off to workers.</p>
</div>
<div class="section level2">
<h2 id="scope">Scope<a class="anchor" aria-label="anchor" href="#scope"></a>
</h2>
<p>There’s nothing specific about this package that necessitates the expression provided to <code><a href="reference/syrup.html">syrup()</a></code> is run in parallel. Said another way, syrup will work just fine with “normal,” sequentially-run R code. That said, there are many better, more fine-grained tools for the job in the case of sequential R code, such as <code><a href="https://rdrr.io/r/utils/Rprofmem.html" class="external-link">Rprofmem()</a></code>, the <a href="https://CRAN.R-project.org/package=profmem" class="external-link">profmem</a> package, the <a href="https://bench.r-lib.org/" class="external-link">bench</a> package, and packages in the <a href="https://github.com/r-prof" class="external-link">R-prof</a> GitHub organization.</p>
<p>Results from syrup only provide enough detail for the coarsest analyses of memory usage, but they do provide an entry to “profiling” memory usage for R code that runs in parallel.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/simonpcouch/syrup/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/simonpcouch/syrup/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing syrup</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Simon Couch <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-5676-5107" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Posit Software, PBC <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=syrup" class="external-link"><img src="https://www.r-pkg.org/badges/version/syrup" alt="CRAN status"></a></li>
<li><a href="https://github.com/simonpcouch/syrup/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/simonpcouch/syrup/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
