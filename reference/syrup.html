<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Memory and CPU Usage Information for Parallel R Code — syrup • syrup</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Memory and CPU Usage Information for Parallel R Code — syrup"><meta name="description" content="This function is a wrapper around the system command ps that can
be used to benchmark (peak) memory and CPU usage of parallel R code.
By taking snapshots the memory usage of R processes at a regular interval,
the function dynamically builds up a profile of their usage of system
resources."><meta property="og:description" content="This function is a wrapper around the system command ps that can
be used to benchmark (peak) memory and CPU usage of parallel R code.
By taking snapshots the memory usage of R processes at a regular interval,
the function dynamically builds up a profile of their usage of system
resources."><meta property="og:image" content="https://simonpcouch.github.io/syrup/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">syrup</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simonpcouch/syrup/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Memory and CPU Usage Information for Parallel R Code</h1>
      <small class="dont-index">Source: <a href="https://github.com/simonpcouch/syrup/blob/main/R/syrup.R" class="external-link"><code>R/syrup.R</code></a></small>
      <div class="d-none name"><code>syrup.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is a wrapper around the system command <code>ps</code> that can
be used to benchmark (peak) memory and CPU usage of parallel R code.
By taking snapshots the memory usage of R processes at a regular <code>interval</code>,
the function dynamically builds up a profile of their usage of system
resources.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">syrup</span><span class="op">(</span><span class="va">expr</span>, interval <span class="op">=</span> <span class="fl">0.5</span>, peak <span class="op">=</span> <span class="cn">FALSE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">caller_env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>An expression.</p></dd>


<dt id="arg-interval">interval<a class="anchor" aria-label="anchor" href="#arg-interval"></a></dt>
<dd><p>The interval at which to take snapshots of respirce usage.
In practice, there's an overhead on top of each of these intervals.</p></dd>


<dt id="arg-peak">peak<a class="anchor" aria-label="anchor" href="#arg-peak"></a></dt>
<dd><p>Whether to return rows for only the "peak" memory usage.
Interpreted as the <code>id</code> with the maximum <code>rss</code> sum. Defaults to <code>FALSE</code>,
but may be helpful to set <code>peak = TRUE</code> for potentially very long-running
processes so that the tibble doesn't grow too large.</p></dd>


<dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p>The environment to evaluate <code>expr</code> in.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble with columns <code>id</code> and <code>time</code> and a number of columns from
<code><a href="https://ps.r-lib.org/reference/ps.html" class="external-link">ps::ps()</a></code> output describing memory and CPU usage. Notably, the process ID
<code>pid</code>, parent process ID <code>ppid</code>, percent CPU usage, and resident set size
<code>rss</code> (a measure of memory usage).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>While much of the verbiage in the package assumes that the supplied
expression will be distributed across CPU cores, there's nothing specific
about this package that necessitates the expression provided to <code>syrup()</code> is
run in parallel. Said another way, <code>syrup()</code> will work just fine
with "normal," sequentially-run R code (as in the examples). That said,
there are many better, more fine-grained tools for the job in the case of
sequential R code, such as <code><a href="https://rdrr.io/r/utils/Rprofmem.html" class="external-link">Rprofmem()</a></code>, the
<a href="https://CRAN.R-project.org/package=profmem" class="external-link">profmem</a>
package, the <a href="https://bench.r-lib.org/reference/mark.html" class="external-link">bench</a> package, and packages in
the <a href="https://github.com/r-prof" class="external-link">R-prof</a> GitHub organization.</p>
<p>Loosely, the function works by:</p><ul><li><p>Setting up another R process (call it <code>sesh</code>) that queries system
information using <code><a href="https://ps.r-lib.org/reference/ps.html" class="external-link">ps::ps()</a></code> at a regular interval,</p></li>
<li><p>Evaluating the supplied expression,</p></li>
<li><p>Reading the queried system information back into the main process from <code>sesh</code>,</p></li>
<li><p>Closing <code>sesh</code>, and then</p></li>
<li><p>Returning the queried system information.</p></li>
</ul><p>Note that information on the R process <code>sesh</code> is filtered out from the results
automatically.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># pass any expression to syrup. first, sequentially:</span></span></span>
<span class="r-in"><span><span class="va">res_syrup</span> <span class="op">&lt;-</span> <span class="fu">syrup</span><span class="op">(</span><span class="op">{</span><span class="va">res_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_syrup</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 3 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      id time                  pid  ppid name  pct_cpu       rss       vms</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>     1 2025-06-21 <span style="color: #949494;">15:23:48</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R          <span style="color: #BB0000;">NA</span>     257MB     919MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>     2 2025-06-21 <span style="color: #949494;">15:23:49</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     257MB     919MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>     3 2025-06-21 <span style="color: #949494;">15:23:49</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     257MB     919MB</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to snapshot memory and CPU information more (or less) often, set `interval`</span></span></span>
<span class="r-in"><span><span class="fu">syrup</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, interval <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 14 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       id time                  pid  ppid name  pct_cpu       rss       vms</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1 2025-06-21 <span style="color: #949494;">15:23:50</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R          <span style="color: #BB0000;">NA</span>     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     2 2025-06-21 <span style="color: #949494;">15:23:50</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     3 2025-06-21 <span style="color: #949494;">15:23:50</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     4 2025-06-21 <span style="color: #949494;">15:23:50</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     5 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     7 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     8 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     9 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    10 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>    11 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>    12 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span>    13 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span>    14 2025-06-21 <span style="color: #949494;">15:23:51</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R           0     266MB     929MB</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use `peak = TRUE` to return only the snapshot with</span></span></span>
<span class="r-in"><span><span class="co"># the highest memory usage (as `sum(rss)`)</span></span></span>
<span class="r-in"><span><span class="fu">syrup</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, interval <span class="op">=</span> <span class="fl">.01</span>, peak <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      id time                  pid  ppid name  pct_cpu       rss       vms</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>     1 2025-06-21 <span style="color: #949494;">15:23:52</span>  <span style="text-decoration: underline;">7</span>392  <span style="text-decoration: underline;">1</span>990 R          <span style="color: #BB0000;">NA</span>     266MB     929MB</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># results from syrup are more---or maybe only---useful when</span></span></span>
<span class="r-in"><span><span class="co"># computations are evaluated in parallel. see package README</span></span></span>
<span class="r-in"><span><span class="co"># for an example.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

